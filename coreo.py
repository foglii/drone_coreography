import time

import cflib.crtp
from cflib.crazyflie.swarm import CachedCfFactory
from cflib.crazyflie.swarm import Swarm
import sys

from cflib.crazyflie import Crazyflie
from cflib.crazyflie.log import LogConfig
from cflib.crazyflie.mem import MemoryElement
from cflib.crazyflie.mem import Poly4D
from cflib.crazyflie.syncCrazyflie import SyncCrazyflie
from cflib.crazyflie.syncLogger import SyncLogger
from cflib.utils import uri_helper

# Change uris and sequences according to your setup
# URIs in a swarm using the same radio must also be on the same channel
URI1 = 'radio://0/80/2M/E7E7E7E7E6'
URI2 = 'radio://0/80/2M/E7E7E7E7E7'
URI3 = 'radio://0/80/2M/E7E7E7E7E8'
URI4 = 'radio://0/80/2M/E7E7E7E7E6'
URI5 = 'radio://0/80/2M/E7E7E7E7E5'
URI6 = 'radio://0/80/2M/E7E7E7E7E4'
URI7 = 'radio://0/70/2M/E7E7E7E707'
URI8 = 'radio://0/70/2M/E7E7E7E708'
URI9 = 'radio://0/70/2M/E7E7E7E709'
URI10 = 'radio://0/70/2M/E7E7E7E70A'
# duration,x^0,x^1,x^2,x^3,x^4,x^5,x^6,x^7,y^0,y^1,y^2,y^3,y^4,y^5,y^6,y^7,z^0,z^1,z^2,z^3,z^4,z^5,z^6,z^7,yaw^0,yaw^1,yaw^2,yaw^3,yaw^4,yaw^5,yaw^6,yaw^7
drone1=[[3.213333,0.263739,-0.000000,-0.000000,-1.074997,0.779330,-0.169312,0.006477,0.001014,0.148271,0.000000,-0.000000,2.170789,-2.910743,1.397820,-0.292176,0.022735,0.416060,0.000000,-0.000000,0.213684,-0.235018,0.106662,-0.022379,0.001791,-0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.397399,1.001530,-0.604390,-0.458644,0.006427,0.191343,-0.060380,0.005223,-0.497694,0.701215,0.689870,0.043407,-0.505577,0.150885,-0.001088,-0.002268,0.690091,0.087554,-0.015080,0.038867,-0.029852,0.010059,-0.001497,0.000075,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.403631,1.903122,-0.122754,-1.194231,0.219307,0.161701,-0.056640,0.004966,-1.111871,0.101135,1.792091,-0.060432,-0.723624,0.265654,-0.028691,0.000359,0.986636,0.096910,-0.005844,-0.019260,0.034473,-0.020272,0.005098,-0.000469,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.377392,1.271565,0.752781,-0.731779,-0.243006,0.236592,-0.049231,0.003144,-0.740508,-0.883584,1.221625,0.370234,-0.346539,-0.023503,0.035762,-0.004489,1.283417,0.099026,-0.000821,-0.035326,0.049517,-0.026724,0.006409,-0.000571,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.725646,0.346610,1.032782,-0.361522,-0.178083,0.058255,0.005452,-0.001902,-0.191080,-1.166991,0.418890,0.469011,-0.007197,-0.156225,0.048106,-0.004074,1.580622,0.099539,0.001548,-0.035743,0.045799,-0.024080,0.005830,-0.000538,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.698260,-0.245618,0.877832,-0.115471,-0.390365,0.262328,-0.064759,0.005658,0.201996,-0.695306,0.279757,0.963919,-1.232674,0.593355,-0.129317,0.010647,1.877754,0.079850,-0.044453,-0.073546,0.095251,-0.040639,0.007184,-0.000417,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.050000,0.749903,-0.000000,-0.000000,0.033174,-0.002825,-0.021529,0.009878,-0.001223,0.000000,-0.000000,0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000,1.898654,0.000000,0.000000,0.301357,0.015127,-0.211621,0.084965,-0.009594,0.000000,-0.000000,0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.050000,0.714001,0.042474,0.082028,-0.102384,-0.019768,0.052061,-0.018722,0.002073,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000,0.745516,-0.947023,0.672895,-0.043904,0.035408,-0.107020,0.044592,-0.005370,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000],


[3.213333,0.612586,-0.768786,-1.117109,-0.167465,1.456831,-0.811470,0.170248,-0.012768,0.408892,1.183513,-0.341196,-1.799455,1.141850,-0.174576,-0.014199,0.003719,0.399173,0.005961,0.011480,-0.056496,0.064607,-0.032204,0.007440,-0.000652,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.622457,-0.804961,-1.308095,0.098531,1.448389,-0.907587,0.209325,-0.017211,0.438604,1.199152,-0.823857,-0.694534,-0.029479,0.460882,-0.180973,0.020288,0.400389,0.002982,-0.010699,-0.048591,0.132376,-0.106240,0.034092,-0.003769,0.000000,-0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000],
[3.213333,0.842295,-0.100142,-0.820031,-0.316879,0.313813,0.075907,-0.061897,0.007880,0.033532,0.504674,0.113272,2.129840,-3.546073,1.889328,-0.421888,0.034358,0.602356,0.398629,-0.120744,-0.757409,0.943031,-0.455134,0.099738,-0.008262,-0.000000,-0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.735490,0.414418,-1.546790,-0.116463,0.562165,-0.119174,-0.011019,0.003260,-0.206973,1.300202,0.310319,-0.114341,-1.187396,0.833094,-0.201077,0.016667,0.693077,0.040950,0.053272,-0.277900,0.306049,-0.146749,0.032684,-0.002768,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.740173,0.415761,-1.552172,-0.343867,0.930394,-0.334426,0.043530,-0.001804,-0.203199,1.379642,0.396593,-0.594426,-0.719627,0.641189,-0.165254,0.014188,0.699565,0.020919,0.003164,-0.135564,0.191954,-0.107216,0.026678,-0.002455,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.800320,0.564944,-1.553768,-0.764037,1.064128,-0.220775,-0.017088,0.005834,-0.186814,1.459740,0.620623,-0.354002,-1.528363,1.171979,-0.302138,0.026756,0.719639,0.081920,0.016459,-0.197140,0.204979,-0.091707,0.019251,-0.001552,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.864701,0.280176,-1.601091,0.547435,-0.825205,0.887796,-0.309424,0.034433,-0.235719,1.521282,0.677328,0.360664,-3.026063,2.179095,-0.580872,0.054106,0.749383,0.007541,0.006515,-0.049444,0.057634,-0.028140,0.006289,-0.000531,0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000]]

# duration,x^0,x^1,x^2,x^3,x^4,x^5,x^6,x^7,y^0,y^1,y^2,y^3,y^4,y^5,y^6,y^7,z^0,z^1,z^2,z^3,z^4,z^5,z^6,z^7,yaw^0,yaw^1,yaw^2,yaw^3,yaw^4,yaw^5,yaw^6,yaw^7
drone2=[[3.213333,0.122142,-0.000000,-0.000000,1.111078,-1.892445,1.044139,-0.239169,0.019839,-0.348058,-0.000000,-0.000000,2.582505,-2.976467,1.304703,-0.259554,0.019820,0.396405,0.000000,0.000000,0.080238,-0.054081,0.013260,-0.000943,-0.000044,-0.000000,-0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.174631,1.126997,0.151951,-0.077078,-0.658031,0.403135,-0.082755,0.005723,-0.641389,-0.313884,0.889701,0.765305,-0.973406,0.346328,-0.057615,0.004206,0.642038,0.099700,-0.001686,-0.035518,0.050360,-0.027275,0.006561,-0.000586,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.445480,1.279152,1.225828,-0.469570,-0.794928,0.485150,-0.096526,0.006590,-0.750605,-1.476852,0.989573,1.475881,-1.112625,0.231479,-0.010104,-0.000936,0.939557,0.099497,-0.000545,-0.039163,0.055098,-0.030012,0.007275,-0.000655,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.751743,0.102350,1.462912,-0.055261,-0.623035,0.240583,-0.029440,0.000831,-0.064158,-1.648172,0.198128,0.879442,-0.095457,-0.173392,0.055546,-0.004809,1.237347,0.100900,-0.002325,-0.047485,0.070180,-0.039255,0.009699,-0.000887,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.624786,-0.757758,1.051270,0.342708,-0.454961,0.100485,-0.003237,-0.000536,0.420402,-1.116751,-0.537496,0.661929,0.034797,-0.089790,0.012521,0.000149,1.535520,0.104606,-0.007362,-0.072657,0.117529,-0.069170,0.017743,-0.001672,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.376175,-0.988492,0.472409,0.720585,-0.608405,0.155815,-0.007409,-0.001443,0.505052,-0.425340,-0.693651,0.704122,0.083870,-0.262968,0.090974,-0.009700,1.836431,0.119120,-0.030092,-0.169183,0.262845,-0.164801,0.046993,-0.005005,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.050000,0.449756,0.000000,-0.000000,0.005434,-0.005288,0.001514,-0.000069,-0.000017,0.000000,-0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000,1.907736,-0.000000,-0.000000,-4.997446,6.339489,-2.926910,0.579226,-0.041403,0.000000,-0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.050000,0.449541,0.003576,0.002335,-0.007811,0.001766,0.001886,-0.000918,0.000113,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000,0.821409,-2.451590,0.051431,3.351697,-0.276304,-1.492874,0.647218,-0.077914,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000],

[3.213333,0.368885,-0.470261,-0.696171,0.046666,0.676313,-0.374104,0.073080,-0.004876,0.242609,0.716946,-0.167914,-1.184351,0.785114,-0.149749,0.001249,0.001405,0.698038,0.006020,0.021823,-0.070660,0.070343,-0.032065,0.006910,-0.000571,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.361481,-0.521184,-0.677973,0.411877,0.033250,0.053160,-0.050064,0.007885,0.264118,0.713953,-0.525752,-0.484125,0.285701,-0.006055,-0.009520,0.000426,0.699666,0.003393,0.002130,-0.022868,0.029835,-0.016027,0.003894,-0.000353,0.000000,-0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000],
[3.213333,-0.110963,-1.514110,-0.344192,2.530659,-1.476346,0.312851,-0.024213,0.000363,0.480191,0.743922,-1.659944,-2.163962,3.537567,-1.664329,0.335955,-0.025448,0.700387,0.005174,-0.003135,-0.029233,0.045966,-0.026298,0.006569,-0.000604,-0.000000,-0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.159533,-1.474581,0.274732,1.143644,-0.268078,-0.199208,0.080972,-0.008023,0.725827,-0.211900,-1.382939,-0.571604,1.637235,-0.777230,0.146520,-0.010076,0.700429,0.008666,-0.003400,-0.048873,0.074094,-0.041993,0.010476,-0.000966,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.185676,-1.437274,0.369109,0.922769,-0.068954,-0.290280,0.101514,-0.009842,0.738196,-0.307153,-1.509841,-0.150462,1.322208,-0.682268,0.135800,-0.009925,0.701389,0.013327,-0.011014,-0.084284,0.143995,-0.087222,0.022771,-0.002163,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.235881,-1.545812,0.221310,0.702764,0.795595,-0.911664,0.272531,-0.026330,0.785220,-0.234498,-1.646361,-0.524733,1.725841,-0.794955,0.139959,-0.008619,0.720405,0.083787,0.011347,-0.201106,0.216196,-0.098711,0.021025,-0.001714,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.228414,-1.453095,0.214390,-0.609727,3.064233,-2.347033,0.661458,-0.064394,0.866278,-0.517843,-1.722368,0.288720,0.802056,-0.322061,0.022723,0.002748,0.749132,0.009246,0.007940,-0.058662,0.067728,-0.032870,0.007315,-0.000616,0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000]]

# duration,x^0,x^1,x^2,x^3,x^4,x^5,x^6,x^7,y^0,y^1,y^2,y^3,y^4,y^5,y^6,y^7,z^0,z^1,z^2,z^3,z^4,z^5,z^6,z^7,yaw^0,yaw^1,yaw^2,yaw^3,yaw^4,yaw^5,yaw^6,yaw^7
drone3=[[3.213333,-0.362956,0.000000,0.000000,2.779335,-3.598677,1.723776,-0.365513,0.029120,-0.515989,0.000000,-0.000000,0.687439,-0.262062,-0.076556,0.044826,-0.005034,0.400972,-0.000000,0.000000,-0.065443,0.121274,-0.068724,0.016367,-0.001424,-0.000000,0.000000,0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.640125,0.466110,0.738789,0.626473,-1.254357,0.565937,-0.106280,0.007585,-0.335894,-0.948148,0.459288,0.374360,0.079099,-0.195404,0.055900,-0.004731,0.594755,0.100590,0.008388,-0.056581,0.066980,-0.033632,0.007747,-0.000673,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.746761,-0.182555,1.439873,0.715988,-1.132796,0.354898,-0.036951,0.000600,0.072475,-1.620269,-0.504573,0.655024,0.818653,-0.690232,0.172220,-0.014444,0.893275,0.099202,-0.000415,-0.039703,0.056359,-0.030889,0.007515,-0.000678,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.455775,-1.236915,1.134588,0.518040,-0.293123,-0.085460,0.050991,-0.005690,0.698035,-1.171412,-0.982277,0.291097,0.828397,-0.505071,0.106105,-0.007849,1.190852,0.101670,-0.000977,-0.048459,0.067255,-0.036135,0.008653,-0.000771,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.048419,-1.385961,0.227919,0.532467,0.144153,-0.268032,0.078256,-0.007085,0.777116,-0.150518,-1.217575,-0.092942,0.803291,-0.386620,0.074806,-0.005562,1.488283,0.101380,-0.000658,-0.050716,0.072296,-0.039899,0.009790,-0.000892,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.147645,-0.916693,-0.462728,0.200664,0.819083,-0.652032,0.180630,-0.017422,0.503078,0.561046,-1.009982,-0.804454,1.628589,-0.860884,0.193787,-0.016175,1.786650,0.104499,-0.007153,-0.071969,0.142047,-0.110502,0.036059,-0.004171,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.050000,0.150367,0.000000,-0.000000,-0.004246,0.003930,-0.000622,-0.000268,0.000063,0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000,1.904833,-0.000000,0.000000,-4.245231,5.795460,-2.950203,0.653673,-0.053152,0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.050000,0.143823,-0.013217,0.003095,0.023310,0.001102,-0.014435,0.005998,-0.000716,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000,0.017286,-1.591851,1.473611,1.958892,-0.421331,-1.006350,0.480069,-0.060171,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000],

[3.213333,0.116637,-0.127284,-0.141857,-0.342714,0.623037,-0.321935,0.069999,-0.005637,0.078848,0.241066,-0.027668,-0.450693,0.298295,-0.058910,0.000747,0.000573,1.095221,0.017530,0.052712,-0.181682,0.182211,-0.082769,0.017697,-0.001448,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.125459,-0.133213,-0.269006,-0.158915,0.559820,-0.333947,0.079118,-0.006726,0.083506,0.236948,-0.122230,-0.066076,-0.263351,0.303926,-0.104285,0.011616,1.098312,0.007634,0.012130,-0.045724,0.041965,-0.016925,0.003161,-0.000223,0.000000,-0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000],
[3.213333,0.230654 ,0.293770,0.219945,-0.041603,-0.782548,0.584087,-0.149833,0.013094,-0.278018,-0.382428,0.557372,2.073440,-2.738490,1.246719,-0.251052,0.019151,1.098778,-0.002442,0.008253,0.012393,-0.032722,0.022398,-0.006247,0.000622,-0.000000,-0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.110682,0.839272,-0.281237,-0.355879,-0.108832,0.216658,-0.064359,0.005726,-0.435561,0.110619,0.827731,0.473184,-1.178150,0.580533,-0.117347,0.008845,1.097185,-0.012126,0.020192,0.081978,-0.159619,0.101416,-0.027274,0.002658,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.121830,0.889044,-0.301247,-0.725691,0.445366,-0.093984,0.011867,-0.001103,-0.452349,0.141841,0.982319,0.407606,-1.442265,0.838411,-0.200761,0.017888,1.090582,-0.045208,0.075329,0.321571,-0.637963,0.412061,-0.111906,0.010913,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.237336,1.373973,0.154485,-0.946653,-0.778568,0.948540,-0.285597,0.027659,-0.598817,-0.224421,1.364311,1.966712,-3.108773,1.386097,-0.259743,0.017990,0.956931,-0.536711,-0.078189,1.133885,-1.142716,0.494155,-0.100419,0.007857,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.231582,1.441651,-0.234708,0.680747,-3.130243,2.374929,-0.667071,0.064831,-0.859136,0.496499,1.660949,-0.099822,-0.977748,0.397453,-0.038160,-0.001525,0.755706,-0.016991,-0.050117,0.153728,-0.143282,0.061636,-0.012649,0.001004,0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000]]

# duration,x^0,x^1,x^2,x^3,x^4,x^5,x^6,x^7,y^0,y^1,y^2,y^3,y^4,y^5,y^6,y^7,z^0,z^1,z^2,z^3,z^4,z^5,z^6,z^7,yaw^0,yaw^1,yaw^2,yaw^3,yaw^4,yaw^5,yaw^6,yaw^7
drone4=[[3.213333,-0.755216,-0.000000,0.000000,2.056711,-2.145498,0.854011,-0.154849,0.010865,-0.152032,0.000000,-0.000000,-2.370161,3.549773,-1.879136,0.428336,-0.035976,0.402668,0.000000,-0.000000,-0.040133,0.049786,-0.019363,0.003106,-0.000174,-0.000000,-0.000000,0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.714352,-0.351217,0.789859,0.449714,-0.413320,0.038664,0.016404,-0.002504,0.170290,-0.794970,-0.225402,-0.781817,1.709252,-0.935528,0.209411,-0.017221,0.550807,0.089324,-0.008527,0.013792,-0.002050,-0.003689,0.001660,-0.000199,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.386577,-1.166495,0.564493,0.670207,0.168598,-0.408149,0.128107,-0.012085,0.690607,-0.577923,-1.269211,-0.710343,1.782486,-0.823037,0.151247,-0.010102,0.847632,0.099874,-0.005484,-0.035571,0.056311,-0.031865,0.007859,-0.000714,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.355328,-1.775182,-0.021801,0.607654,0.407436,-0.424379,0.109462,-0.009192,1.002057,0.133569,-1.561911,-0.112968,0.660230,-0.208230,0.016840,0.000405,1.144435,0.101874,-0.000799,-0.051193,0.072419,-0.039684,0.009676,-0.000876,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.623539,-1.076719,-0.804656,0.361470,0.582124,-0.386841,0.084287,-0.006418,0.578089,0.949656,-0.995427,-0.443377,0.353797,-0.003952,-0.023150,0.002983,1.442673,0.104194,-0.004839,-0.067065,0.103047,-0.059030,0.014868,-0.001383,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.469621,-0.208840,-0.983419,-0.115969,0.785535,-0.397355,0.078974,-0.005765,0.074877,1.069033,-0.221713,-0.533807,-0.122056,0.349718,-0.125976,0.013666,1.741861,0.110701,-0.023352,-0.131172,0.270516,-0.188094,0.054895,-0.005779,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.050000,-0.149886,0.000000,0.000000,0.001987,-0.004483,0.003176,-0.000904,0.000090,0.000000,0.000000,0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000,1.902474,0.000000,-0.000000,-2.978016,3.377932,-1.452272,0.278912,-0.020138,0.000000,0.000000,0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.050000,-0.149678,-0.002806,-0.004647,0.002890,0.009531,-0.009161,0.002853,-0.000299,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000,1.497537,0.094251,-0.333294,0.411489,-0.742938,0.534836,-0.155475,0.015895,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000],

[3.213333,-0.122777,0.157640,0.227850,-0.001307,-0.245782,0.137235,-0.027771,0.001963,-0.088733,-0.211428,0.177787,-0.017317,0.171072,-0.157331,0.046283,-0.004486,1.102693,-0.004560,-0.030860,0.078786,-0.071280,0.030669,-0.006359,0.000511,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.122508,0.163858,0.234468,-0.092326,-0.054861,-0.015805,0.023491,-0.004031,-0.085500,-0.201929,0.152508,-0.090135,0.335429,-0.264978,0.074576,-0.007046,1.100097,-0.002608,-0.000922,0.018389,-0.025612,0.014268,-0.003557,0.000329,0.000000,-0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000],
[3.213333,0.098710,0.328025,-0.731685,-1.883148,2.992429,-1.501076,0.323290,-0.025860,0.005740,0.247272,0.719477,0.055761,-1.206139,0.788274,-0.187662,0.015563,1.099400,-0.005160,0.004979,0.031173,-0.054399,0.033123,-0.008683,0.000831,-0.000000,-0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.321001,-0.489491,-0.568377,-0.380247,1.263846,-0.708259,0.156352,-0.012483,0.003747,0.912313,-0.075945,-0.510910,-0.110467,0.237307,-0.068238,0.005810,1.097556,-0.014054,0.018135,0.091297,-0.168883,0.105595,-0.028178,0.002734,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.329647,-0.549152,-0.692872,-0.094482,1.157972,-0.746776,0.183703,-0.016319,0.153770,0.946833,-0.436458,-1.028506,0.961068,-0.381347,0.083702,-0.007935,1.090200,-0.046107,0.076966,0.327259,-0.647848,0.417633,-0.113239,0.011030,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.399772,-0.478570,-1.257596,-1.310739,3.191269,-1.733274,0.381747,-0.030656,0.459458,1.453835,-0.563679,-2.116537,1.237974,-0.037769,-0.081924,0.012066,0.957419,-0.537978,-0.081812,1.136662,-1.138205,0.489253,-0.098838,0.007690,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.628207,-1.135360,-1.319946,-0.334544,2.515776,-1.584500,0.378657,-0.032129,0.627682,1.012100,-1.014361,0.555109,-2.134269,1.817701,-0.549952,0.056195,0.755891,-0.011891,-0.051513,0.131956,-0.114104,0.046696,-0.009233,0.000712,0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000]]


# duration,x^0,x^1,x^2,x^3,x^4,x^5,x^6,x^7,y^0,y^1,y^2,y^3,y^4,y^5,y^6,y^7,z^0,z^1,z^2,z^3,z^4,z^5,z^6,z^7,yaw^0,yaw^1,yaw^2,yaw^3,yaw^4,yaw^5,yaw^6,yaw^7
drone5=[[3.213333,-0.636695,0.000000,0.000000,-1.004525,1.992184,-1.208899,0.298347,-0.026324,0.372436,-0.000000,0.000000,-3.129114,3.853281,-1.778803,0.366457,-0.028514,0.400728,0.000000,-0.000000,0.006578,-0.018065,0.012980,-0.003269,0.000272,-0.000000,-0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.408525,-0.747037,0.374341,-0.475050,1.152309,-0.719282,0.173142,-0.014724,0.518897,-0.237143,-0.728155,-0.499442,0.927255,-0.368836,0.058554,-0.003363,0.504647,0.105119,-0.017192,-0.038098,0.071101,-0.041517,0.010314,-0.000936,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.250325,-1.118067,-0.501151,0.018897,1.162280,-0.708615,0.153115,-0.011498,0.730490,0.501059,-1.027097,-0.359306,0.022746,0.305782,-0.119231,0.012679,0.800058,0.104478,0.003518,-0.060871,0.074480,-0.037038,0.008366,-0.000711,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,1.146664,-1.115202,-1.279621,0.489340,0.586187,-0.342374,0.061917,-0.003682,0.591547,1.414138,-1.086115,-0.300949,-0.145796,0.318316,-0.101663,0.009726,1.097533,0.096788,0.003241,-0.030924,0.041510,-0.023034,0.005767,-0.000538,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.923819,-0.000581,-1.317104,0.017673,0.449774,-0.127626,0.002894,0.001421,-0.067086,1.426360,-0.014070,-0.475563,-0.402231,0.407950,-0.108778,0.009564,1.397205,0.101055,-0.011163,-0.055308,0.101703,-0.063035,0.016666,-0.001603,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.350900,0.639990,-0.774937,-0.155860,-0.063201,0.221450,-0.080258,0.008402,-0.448919,0.793378,0.682529,-0.017559,-1.046920,0.688685,-0.165554,0.013962,1.697445,0.119543,-0.034701,-0.177515,0.339466,-0.220130,0.061147,-0.006229,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.050000,-0.449978,-0.000000,-0.000000,0.000223,-0.001218,0.001141,-0.000376,0.000041,0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000,1.901848,0.000000,0.000000,-2.147719,1.922307,-0.588521,0.063667,-0.000678,0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.050000,-0.449535,-0.001707,-0.001923,0.002972,0.001265,-0.002263,0.000798,-0.000088,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000,1.571920,0.589750,-0.449394,0.633182,-1.500727,1.054468,-0.291774,0.028502,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000],


[3.213333,-0.365256,0.455706,0.637969,0.190855,-0.958491,0.523446,-0.109673,0.008256,-0.241023,-0.714462,0.146143,1.213773,-0.799506,0.151455,-0.000678,-0.001529,0.691032,0.006199,0.151217,-0.345703,0.301477,-0.126721,0.025802,-0.002045,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.372249,0.481677,0.777084,-0.049487,-0.870729,0.542981,-0.124924,0.010254,-0.261888,-0.719709,0.485657,0.422272,0.022463,-0.281728,0.110148,-0.012327,0.699082,0.002175,-0.002151,-0.066549,0.160838,-0.128671,0.041632,-0.004637,0.000000,-0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000],
[3.213333,-0.507039,0.062446,0.499537,0.188979,-0.205326,-0.030291,0.032367,-0.004220,-0.021680,-0.300331,-0.062694,-1.286478,2.130909,-1.133545,0.252913,-0.020587,0.968971,0.522640,-0.154443,-0.963011,1.181801,-0.563054,0.121914,-0.009986,-0.000000,-0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.444114,-0.260789,0.950149,0.152007,-0.503431,0.179150,-0.022754,0.000938,0.125083,-0.780826,-0.190739,0.067763,0.721784,-0.506732,0.122515,-0.010176,1.088729,0.041249,0.088241,-0.273463,0.226170,-0.080263,0.012418,-0.000639,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.456347,-0.300678,1.027796,0.581063,-1.326531,0.704820,-0.164863,0.014798,0.120683,-0.824944,-0.231916,0.348523,0.437890,-0.391585,0.102751,-0.009100,1.087131,-0.026393,0.099450,0.203989,-0.514068,0.354859,-0.099583,0.009900,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.637969,-0.873467,1.109822,2.126406,-2.241683,0.694947,-0.074921,0.001121,0.094012,-1.066798,-0.816424,-0.230327,2.323086,-1.566092,0.389713,-0.034073,0.956237,-0.531603,-0.072274,1.099278,-1.104066,0.475695,-0.096359,0.007519,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.859987,-0.284090,1.557323,-0.462572,0.762921,-0.865551,0.305531,-0.034165,0.229026,-1.481708,-0.626758,-0.616798,3.299816,-2.306481,0.608452,-0.056384,0.755017,-0.015126,-0.046127,0.143165,-0.135008,0.058635,-0.012126,0.000969,0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000]]

# duration,x^0,x^1,x^2,x^3,x^4,x^5,x^6,x^7,y^0,y^1,y^2,y^3,y^4,y^5,y^6,y^7,z^0,z^1,z^2,z^3,z^4,z^5,z^6,z^7,yaw^0,yaw^1,yaw^2,yaw^3,yaw^4,yaw^5,yaw^6,yaw^7
drone6=[[3.213333,-0.119448,0.000000,-0.000000,-3.246602,4.391540,-2.178687,0.474243,-0.038451,0.514092,0.000000,-0.000000,-0.510605,-0.124870,0.362755,-0.129302,0.013653,0.400402,-0.000000,0.000000,-0.011552,0.024133,-0.018135,0.005694,-0.000619,-0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.026475,-0.621311,-0.304055,-0.541671,1.219137,-0.618798,0.126389,-0.009435,0.491229,0.415340,-0.854531,0.486520,-0.732643,0.515332,-0.138385,0.012732,0.454351,0.108993,0.016905,-0.106459,0.122166,-0.059958,0.013562,-0.001161,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.664161,-0.328280,-1.060843,-0.102245,0.594153,-0.159806,-0.002083,0.002765,0.276548,1.125632,-0.284356,-0.041161,-0.882891,0.647706,-0.157057,0.012788,0.753991,0.102949,0.003034,-0.059200,0.075622,-0.038920,0.009044,-0.000788,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,1.350457,0.380453,-1.694963,-0.029117,0.413085,-0.046666,-0.022550,0.003757,-0.299030,1.836952,0.359498,-1.010042,-0.076082,0.244550,-0.062719,0.004767,1.051495,0.099933,0.002255,-0.042886,0.055638,-0.029094,0.006862,-0.000606,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,0.624255,1.128751,-0.902858,-0.483715,0.188489,0.108177,-0.049138,0.005072,-0.710233,0.937749,1.040868,-0.568647,-0.281238,0.178735,-0.026009,0.000717,1.349372,0.099069,-0.000480,-0.038265,0.055084,-0.030679,0.007593,-0.000697,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.115909,1.105323,-0.088372,-0.571429,0.072793,0.070762,-0.015787,0.000370,-0.665121,0.027195,1.000165,-0.312934,0.183789,-0.258541,0.101278,-0.011836,1.647886,0.101522,-0.009234,-0.061295,0.116773,-0.078594,0.023102,-0.002518,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.501584,0.622853,-0.191066,-1.423097,1.438565,-0.548159,0.092294,-0.005702,0.010383,0.302102,0.400392,-1.607338,1.493576,-0.623693,0.123617,-0.009459,1.893029,-0.174309,-0.614703,-0.742629,0.866350,-0.252569,0.022554,0.000176,0.000000,-0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000],
[3.213333,-0.677091,-0.198766,-0.080451,0.436397,-0.230747,0.005788,0.016237,-0.002317,-0.022557,0.042596,0.143303,-0.074842,-0.455861,0.465113,-0.154302,0.016855,1.635092,0.926486,-0.567591,-0.063940,-0.490661,0.455732,-0.130829,0.012434,-0.000000,-0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.607970,0.782977,1.047082,0.195997,-1.397263,0.754329,-0.152484,0.010904,-0.387445,-1.200561,0.000470,2.595621,-1.849398,0.477749,-0.048724,0.001363,0.407180,0.010129,-0.145666,0.267557,-0.206428,0.078852,-0.014734,0.001075,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.614038,0.844042,1.238742,-0.374310,-0.883215,0.534881,-0.106496,0.007104,-0.438830,-1.214433,0.844322,0.908007,-0.454853,-0.092034,0.064685,-0.007404,0.401597,-0.001617,-0.020719,-0.008989,0.090408,-0.086333,0.029679,-0.003397,0.000000,-0.000000,0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000],
[3.213333,-0.556139,0.963371,1.179878,-0.657087,-0.600523,0.429522,-0.088824,0.005986,-0.501061,-1.177946,1.064251,0.855866,-0.617578,0.016380,0.039873,-0.005450,0.603105,0.394898,-0.124467,-0.741726,0.930477,-0.451247,0.099303,-0.008258,-0.000000,-0.000000,-0.000000,0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.562631,1.005252,1.166533,-0.631837,-0.680846,0.488036,-0.104972,0.007534,-0.515807,-1.092934,1.047188,0.732267,-0.474975,-0.051900,0.055043,-0.006725,0.693840,0.044912,0.048472,-0.294688,0.334910,-0.163374,0.036809,-0.003143,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.550431,1.016748,1.152202,-0.533609,-0.875652,0.620371,-0.142208,0.011280,-0.533771,-1.063226,1.104309,0.699195,-0.526922,-0.002497,0.040312,-0.005256,0.699689,0.025571,0.002376,-0.162547,0.230682,-0.128463,0.031839,-0.002920,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.563210,0.995489,1.323892,-0.006525,-1.758530,1.077196,-0.242190,0.019319,-0.598246,-1.211385,1.024510,0.805100,-0.096823,-0.430367,0.174791,-0.019248,0.719583,0.088302,0.017059,-0.228742,0.245292,-0.112192,0.023947,-0.001956,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000,0.000000,-0.000000],
[3.213333,-0.636923,1.185407,1.390891,-0.006930,-2.153042,1.416064,-0.342225,0.029123,-0.631009,-0.992161,1.048159,-0.713478,2.305242,-1.898273,0.567586,-0.057664,0.749142,0.010824,0.008599,-0.068523,0.079933,-0.038972,0.008695,-0.000733,0.000000,-0.000000,-0.000000,-0.000000,-0.000000,-0.000000,0.000000,-0.000000]]





seq_args_ = {
   # URI1: [1,drone1],
   #URI2: [2,drone2],
   # URI3: [3,drone3],
    URI4: [4,drone4],
    URI5: [5,drone5],
    #URI6: [6,drone6],
    #URI7: [sequence7],
    #URI8: [sequence8],
    #URI9: [sequence9],
    #URI10: [sequence10],
}

seq_argss_ = {
    #URI1: [1,47.9],
   # URI2: [2,47.9],
   # URI3: [3,47.9],
    URI4: [4,47.9],
    URI5: [5,47.9],
    #URI6: [6,11.1],
    #URI7: [sequence7],
    #URI8: [sequence8],
    #URI9: [sequence9],
    #URI10: [sequence10],
}

# List of URIs, comment the one you do not want to fly
uris = {
    #URI1,
   # URI2,
   # URI3,
    URI4,
    URI5,
   # URI6,
   # URI7,
   # URI8,
   # URI9,
   # URI10
}

#######
def activate_mellinger_controller(scf):
    scf.cf.param.set_value('stabilizer.controller', '2')


def upload_trajectory(scf, trajectory_id, trajectory):
    """Upload one trajectory to one Crazyflie"""
    try:
        mems = scf.cf.mem.get_mems(MemoryElement.TYPE_TRAJ)
        if not mems:
            print(f"[{scf.cf.link_uri}] No trajectory memory found!")
            return
        trajectory_mem = mems[0]
        trajectory_mem.trajectory = []

        total_duration = 0
        for row in trajectory:
            duration = row[0]
            x = Poly4D.Poly(row[1:9])
            y = Poly4D.Poly(row[9:17])
            z = Poly4D.Poly(row[17:25])
            yaw = Poly4D.Poly(row[25:33])
            trajectory_mem.trajectory.append(Poly4D(duration, x, y, z, yaw))
            total_duration += duration

        if not trajectory_mem.write_data_sync():
            print(f"[{scf.cf.link_uri}] Upload failed.")
            return

        scf.cf.high_level_commander.define_trajectory(trajectory_id, 0, len(trajectory))
        print(f"[{scf.cf.link_uri}] Trajectory uploaded ({len(trajectory)} segments, {total_duration:.1f}s)")
        print(total_duration)
        return total_duration

    except Exception as e:
        print(f"[{scf.cf.link_uri}] ERROR uploading trajectory: {e}")
        

def landd(scf):
    commander = scf.cf.high_level_commander
    commander.land(0.0,4.0)
    time.sleep(4.0)
    commander.stop()
def run_trajectory(scf, trajectory_id, duration):
    try:
        print('run_trajectory function')
        """Execute a defined trajectory"""
        commander = scf.cf.high_level_commander

        commander.takeoff(0.5, 2.0)
        time.sleep(3.0)
        commander.start_trajectory(trajectory_id, 1.0, False)
        '''print(f"[{scf.cf.link_uri}] Running trajectory {trajectory_id} for {duration:.1f}s")'''
        time.sleep(duration)
        commander.land(0.0, 2.0)
        time.sleep(3.0)
        commander.stop()
    except Exception as e:
        print(f"[{scf.cf.link_uri}] ERROR uploading trajectory: {e}")
        commander.land(0.0, 2.0)


def wait_for_param_download(scf):
    while not scf.cf.param.is_updated:
        time.sleep(0.5)
    print(f"[{scf.cf.link_uri}] Parameters ready")


def light_check(scf):
    scf.cf.param.set_value('led.bitmask', 255)
    time.sleep(1)
    scf.cf.param.set_value('led.bitmask', 0)


# --- Swarm execution ---
if __name__ == '__main__':
    cflib.crtp.init_drivers()

    factory = CachedCfFactory(rw_cache='./cache')

    with Swarm(uris, factory=factory) as swarm:
        try:
            swarm.parallel_safe(wait_for_param_download)
            swarm.parallel_safe(light_check)
            swarm.reset_estimators()
            swarm.parallel_safe(activate_mellinger_controller)

            # Upload trajectories to each Crazyflie
            durations = swarm.parallel(upload_trajectory, args_dict=seq_args_)
           # durations=[30.3,30.3,30.3,30.3]
           # print("Durations:", durations)
              
            # Wait before flight
            time.sleep(3.0)

            # Run trajectories
            '''run_args = {uri: [seq_args_[uri][0], durations[uri]] for uri in seq_args_}'''
            swarm.parallel_safe(run_trajectory, args_dict=seq_argss_)

        except KeyboardInterrupt:
            print("Emergency stop triggered by user.")
            swarm.parallel_safe(landd)
        except Exception as e:
            print(f"Error: {e}")
            swarm.parallel_safe(landd)

""" def activate_mellinger_controller(cf):
    cf.param.set_value('stabilizer.controller', '2')


def upload_trajectory(cf, trajectory_id, trajectory):
    try:
        print('hello')
        trajectory_mem = cf.cf.mem.get_mems(MemoryElement.TYPE_TRAJ)[0]
        trajectory_mem.trajectory = []

        total_duration = 0
        for row in trajectory:
            duration = row[0]
            x = Poly4D.Poly(row[1:9])
            y = Poly4D.Poly(row[9:17])
            z = Poly4D.Poly(row[17:25])
            yaw = Poly4D.Poly(row[25:33])
            trajectory_mem.trajectory.append(Poly4D(duration, x, y, z, yaw))
            total_duration += duration

        upload_result = trajectory_mem.write_data_sync()
        print('Uploaded')
        if not upload_result:
            print('Upload failed, aborting!')
            sys.exit(1)
        cf.cf.high_level_commander.define_trajectory(trajectory_id, 0, len(trajectory_mem.trajectory))
        print(total_duration)
        return total_duration
    except Exception as e:
        print(e)

#####
def activate_led_bit_mask(scf):
    scf.cf.param.set_value('led.bitmask', 255)

def deactivate_led_bit_mask(scf):
    scf.cf.param.set_value('led.bitmask', 0)

def light_check(scf):
    activate_led_bit_mask(scf)
    time.sleep(2)
    deactivate_led_bit_mask(scf)

def wait_for_param_download(scf):
    while not scf.cf.param.is_updated:
        time.sleep(1.0)
    print('Parameters downloaded for', scf.cf.link_uri)


def arm(scf):
    scf.cf.platform.send_arming_request(True)
    time.sleep(1.0)


def take_off(cf, position):
    take_off_time = 1.0
    sleep_time = 0.1
    steps = int(take_off_time / sleep_time)
    vz = position[2] / take_off_time

    print(vz)

    for i in range(steps):
        cf.commander.send_velocity_world_setpoint(0, 0, vz, 0)
        time.sleep(sleep_time)


def land(cf, position):
    landing_time = 1.0
    sleep_time = 0.1
    steps = int(landing_time / sleep_time)
    vz = -position[2] / landing_time

    print(vz)

    for _ in range(steps):
        cf.commander.send_velocity_world_setpoint(0, 0, vz, 0)
        time.sleep(sleep_time)

    cf.commander.send_stop_setpoint()
    # Hand control over to the high level commander to avoid timeout and locking of the Crazyflie
    cf.commander.send_notify_setpoint_stop()

    # Make sure that the last packet leaves before the link is closed
    # since the message queue is not flushed before closing
    time.sleep(0.1)


def run_sequence(scf, sequence):
    try:
        cf=scf.cf

        take_off(scf, sequence[0])
        for position in sequence:
            print('Setting position {}'.format(position))
            end_time = time.time() + position[3]
            while time.time() < end_time:
                cf.commander.send_position_setpoint(position[0],
                                                    position[1],
                                                    position[2], 0)
                time.sleep(0.1)
        land(scf, sequence[-1])
    except Exception as e:
        print(e)

def run_sequencee(scf, trajectory_id,figure8):
    try:
        print('run function')
        commander = scf.cf.high_level_commander
        relative_yaw=False
        print('second print')
        duration=21
        #duration = upload_trajectory(cf, trajectory_id, figure8)
        print(duration)
        print('The sequence is {:.1f} seconds long'.format(duration))
        # Arm the Crazyflie
        #cf.platform.send_arming_request(True)
        print('third print')
        time.sleep(1.0)

        takeoff_yaw = 3.14 / 2 if relative_yaw else 0.0
        commander.takeoff(0.5, 2.0, yaw=takeoff_yaw)
        time.sleep(3.0)
        commander.start_trajectory(trajectory_id, 1.0, True)
        time.sleep(duration)
        commander.land(0.0, 2.0)
        time.sleep(2)
        commander.stop()
    except Exception as e:
        print(e)


if __name__ == '__main__':
    # logging.basicConfig(level=logging.DEBUG)
    cflib.crtp.init_drivers()

    factory = CachedCfFactory(rw_cache='./cache')
    with Swarm(uris, factory=factory) as swarm:
        try:
            # If the copters are started in their correct positions this is
            # probably not needed. The Kalman filter will have time to converge
            # any way since it takes a while to start them all up and connect. We
            # keep the code here to illustrate how to do it.
            

            # The current values of all parameters are downloaded as a part of the
            # connections sequence. Since we have 10 copters this is clogging up
            # communication and we have to wait for it to finish before we start
            # flying.
            swarm.parallel_safe(light_check)

            durat=swarm.parallel_safe(upload_trajectory,args_dict=seq_args_)
            
            print(durat)
            #swarm.parallel(wait_for_param_download)
            time.sleep(5)

            swarm.reset_estimators()
        
        

            swarm.parallel_safe(activate_mellinger_controller)
            
            
        
            
            
            swarm.parallel_safe(arm)
            #swarm.parallel(run_sequence,args_dict=seq_args_)
            swarm.parallel_safe(run_sequencee,args_dict=seq_args_)

        # swarm.parallel(run_sequence, args_dict=seq_args)
        except Exception as e:
                print(f"Error occurred: {e}")
                swarm.parallel_safe(emergency_stop())


# --- Helper functions ---
 """
